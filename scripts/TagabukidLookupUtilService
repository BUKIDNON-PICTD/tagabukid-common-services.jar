import com.rameses.annotations.*;
import com.rameses.eserver.*;
import com.rameses.common.*;

class TagabukidLookupUtilService
{

	@PersistenceContext('tagabukid_hrmis')
	def emhrmis

	@PersistenceContext('main')
	def emmain

	@PersistenceContext('postgrehrmis')
	def emposthrmis

	@Env
	def env;

	@Service('QueryService') 
	def querySvc; 
	

	@ProxyMethod
	public def lookuphrmis( namedsql, params, pagingKeys) {
		if (! params) params = [:]
		params.searchtext = (params.searchtext && params.searchtext.trim().length() > 0 ? params.searchtext : '') + '%'
		
		def qry = emhrmis.sqlContext.createNamedQuery(namedsql)
		
		if (pagingKeys){
			qry.setPagingKeys(pagingKeys)
		}
		if (params._start != null){
			qry.setFirstResult( params._start )
			qry.setMaxResults(params._limit)
		}
		def filter = [filter:params?.filter];
		return qry.setParameters(params).setVars(filter).resultList 
	}

	@ProxyMethod
	public def lookupmain( namedsql, params, pagingKeys) {
		if (! params) params = [:]
		params.searchtext = (params.searchtext && params.searchtext.trim().length() > 0 ? params.searchtext : '') + '%'

		def qry = emmain.sqlContext.createNamedQuery(namedsql)
		
		if (pagingKeys){
			qry.setPagingKeys(pagingKeys)
		}
		if (params._start != null){
			qry.setFirstResult( params._start )
			qry.setMaxResults(params._limit)
		}
		
		return qry.setParameters(params).resultList 
	}


	@ProxyMethod
	public def lookupPostgreHrmis( namedsql, params, pagingKeys) {
		if (! params) params = [:]
		params.searchtext = (params.searchtext && params.searchtext.trim().length() > 0 ? params.searchtext : '') + '%'
		
		def qry = emposthrmis.sqlContext.createNamedQuery(namedsql)
		
		// if (pagingKeys){
		// 	qry.setPagingKeys(pagingKeys)
		// }
		// if (params._start != null){
		// 	qry.setFirstResult( params._start )
		// 	qry.setMaxResults(params._limit)
		// }
		
		return qry.setParameters(params).resultList 
	}


	// @ProxyMethod
	// public def lookupentitypersonnel(params) {
	// 	if ( !params.searchtext ) return []; 

	// 	def m = [:]; 
	// 	m._start = ( params._start? params._start: 0 );
	// 	m._limit = ( params._limit? params._limit: 10 );
	// 	m._schemaname = 'entity';
	// 	m.where = [' entityname like :ename and type = :etype ', [ename: params.searchtext+'%', etype: params.type]]; 
	// 	m.orderBy = 'entityname'; 
	// 	return querySvc.getList( m ); 
	// }

}
